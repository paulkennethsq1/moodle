{"version":3,"file":"activitiesmarker.min.js","sources":["../src/activitiesmarker.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module to mark activities on course page with a star.\n * @copyright  2022 Astor Bizard\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery'], function($) {\n\n    /**\n     * Call a function each time a course section is loaded.\n     * @param {Function} call Function to call.\n     */\n    function callOnModulesListLoad(call) {\n        call();\n\n        // The following listener is needed for the Tiles course format, where sections are loaded on demand.\n        $(document).ajaxComplete(function(event, xhr, settings) {\n            if (typeof (settings.data) !== 'undefined') {\n                var data = JSON.parse(settings.data);\n                if (data.length > 0 && typeof (data[0].methodname) !== 'undefined') {\n                    if (data[0].methodname == 'format_tiles_get_single_section_page_html' // Tile load.\n                        || data[0].methodname == 'format_tiles_log_tile_click') { // Tile load, cached.\n                        call();\n                    }\n                }\n            }\n        });\n    }\n    return {\n        markActivities: function(activitiesIDs, blockID, blockInstanceName) {\n            // Wait that the DOM is fully loaded.\n            $(function() {\n                var activitiesMarker = $('<i>', {\n                    'class': 'fa fa-star block_completion_levels-required-activity-marker',\n                    'data-blockid': blockID,\n                    title: M.util.get_string('completionrequiredforblockinstance', 'block_completion_levels', blockInstanceName)\n                })[0].outerHTML;\n                callOnModulesListLoad(function() {\n                    activitiesIDs.forEach(function(activityID) {\n                        var $instancename = $('#module-' + activityID + ' .activityname > a').first();\n                        if ($instancename.parent().find(\n                                '.block_completion_levels-required-activity-marker' +\n                                '[data-blockid=\"' + blockID + '\"]').length == 0) {\n                            $instancename.append(activitiesMarker);\n                        }\n                    });\n                });\n            });\n        }\n    };\n});"],"names":["define","$","markActivities","activitiesIDs","blockID","blockInstanceName","call","activitiesMarker","class","title","M","util","get_string","outerHTML","forEach","activityID","$instancename","first","parent","find","length","append","document","ajaxComplete","event","xhr","settings","data","JSON","parse","methodname"],"mappings":";;;;;AAoBAA,kDAAO,CAAC,WAAW,SAASC,GAsBxB,MAAO,CACHC,eAAgB,SAASC,cAAeC,QAASC,mBAE7CJ,GAAE,WACE,IApBmBK,KAoBfC,iBAAmBN,EAAE,MAAO,CAC5BO,MAAS,8DACT,eAAgBJ,QAChBK,MAAOC,EAAEC,KAAKC,WAAW,qCAAsC,0BAA2BP,qBAC3F,GAAGQ,WAxBaP,KAyBG,WAClBH,cAAcW,SAAQ,SAASC,YAC3B,IAAIC,cAAgBf,EAAE,WAAac,WAAa,sBAAsBE,QAGhB,GAFlDD,cAAcE,SAASC,KACnB,mEACoBf,QAAU,MAAMgB,QACxCJ,cAAcK,OAAOd,iBAE7B,GACJ,KA9BRN,EAAEqB,UAAUC,cAAa,SAASC,MAAOC,IAAKC,UAC1C,QAA+B,IAAnBA,SAASC,KAAuB,CACxC,IAAIA,KAAOC,KAAKC,MAAMH,SAASC,MAC3BA,KAAKP,OAAS,QAAqC,IAAxBO,KAAK,GAAGG,aACT,6CAAtBH,KAAK,GAAGG,YACiB,+BAAtBH,KAAK,GAAGG,YACXxB,OAGZ,CACJ,GAqBI,GACJ,EAER"}