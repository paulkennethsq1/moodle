{"version":3,"file":"editform.min.js","sources":["../src/editform.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Edition form reponsivity with total weight calculation and badges deletion.\n * @copyright  2022 Astor Bizard\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/ajax', 'core/notification'], function($, ajax, notification) {\n    return {\n        setupActivitites: function() {\n            var $trackingmodeselect = $('[name=\"config_trackingmethod\"]');\n            var updateMessages = function() {\n                $('[data-block-completion-levels-role=\"nocompletion-message\"]')\n                .toggle($trackingmodeselect.val() == '0');\n                $('[data-block-completion-levels-role=\"nograde-message\"]')\n                .toggle($trackingmodeselect.val() == '1');\n            };\n            $trackingmodeselect.change(updateMessages);\n            updateMessages();\n\n            $('[data-block-completion-levels-role=\"trackall\"]').click(function() {\n                $('[data-block-completion-levels-role=\"trackactivity-checkbox\"]' +\n                  '[data-block-completion-levels-section=\"' + $(this).data('block-completion-levels-section') + '\"]' +\n                  ':not([disabled])')\n                .prop('checked', $(this).data('block-completion-levels-dotrack')).change();\n                M.form.updateFormState($(this).closest('form').attr('id'));\n            });\n\n            var $totalweightmessage = $('<div>', {\n                'class': 'd-inline-block text-info ml-1'\n            })\n            .html(M.util.get_string('totalweight', 'block_completion_levels', '<span></span>'));\n\n            var updateTotalWeight = function() {\n                var count = 0;\n                $('[data-block-completion-levels-role=\"activityweight-text\"]:not([disabled])').each(function() {\n                    count += Number($(this).val());\n                });\n                $totalweightmessage.find('span').html(count);\n            };\n\n            $trackingmodeselect.after($totalweightmessage);\n            setInterval(updateTotalWeight, 1000); // Update weight every second, in case we missed some change.\n\n            $('[data-block-completion-levels-role=\"activityweight-text\"]').focus(function() {\n                $totalweightmessage.insertAfter($(this));\n                updateTotalWeight();\n            })\n            .blur(function() {\n                $totalweightmessage.insertAfter($trackingmodeselect);\n            })\n            .on('input', updateTotalWeight);\n            $('[data-block-completion-levels-role=\"trackactivity-checkbox\"]').change(updateTotalWeight);\n\n        },\n        setupCustomBadges: function(contextid) {\n            var $deletebutton = $('[data-block-completion-levels-role=\"delete-custom-pix\"]');\n            $deletebutton.click(function(e) {\n                M.util.show_confirm_dialog(e, {\n                    message: M.util.get_string('deletebadgeconfirmation', 'block_completion_levels'),\n                    callback: function() {\n                        ajax.call([\n                            {\n                                methodname: 'block_completion_levels_delete_custom_pix',\n                                args: {\n                                    contextid: contextid,\n                                    draftitemid: $('input[name=\"config_levels_pix\"]').val()\n                                },\n                                done: function() {\n                                    // Remove badge preview and button.\n                                    $('.pix-preview[data-source=\"custom\"]').remove();\n                                    $deletebutton.remove();\n                                    // Refresh draft area files.\n                                    // # For an unknown reason, the following instruction with jQuery does not work\n                                    // # (or at least does not trigger the expected listener).\n                                    document.querySelector('fieldset[id^=id_config_levels_pix] .fp-path-folder-name').click();\n                                },\n                                fail: notification.exception\n                            }\n                        ]);\n                    }\n                });\n            })\n            .show();\n        }\n    };\n});"],"names":["define","$","ajax","notification","setupActivitites","$trackingmodeselect","updateMessages","toggle","val","change","click","this","data","prop","M","form","updateFormState","closest","attr","$totalweightmessage","class","html","util","get_string","updateTotalWeight","count","each","Number","find","after","setInterval","focus","insertAfter","blur","on","setupCustomBadges","contextid","$deletebutton","e","show_confirm_dialog","message","callback","call","methodname","args","draftitemid","done","remove","document","querySelector","fail","exception","show"],"mappings":";;;;;AAoBAA,OAAO,mCAAA,CAAC,SAAU,YAAa,sBAAsB,SAASC,EAAGC,KAAMC,cACnE,MAAO,CACHC,iBAAkB,WACd,IAAIC,oBAAsBJ,EAAE,kCACxBK,eAAiB,WACjBL,EAAE,8DACDM,OAAoC,KAA7BF,oBAAoBG,OAC5BP,EAAE,yDACDM,OAAoC,KAA7BF,oBAAoBG,QAEhCH,oBAAoBI,OAAOH,gBAC3BA,iBAEAL,EAAE,kDAAkDS,OAAM,WACtDT,EAAE,sGAC4CA,EAAEU,MAAMC,KAAK,mCADzD,sBAGDC,KAAK,UAAWZ,EAAEU,MAAMC,KAAK,oCAAoCH,SAClEK,EAAEC,KAAKC,gBAAgBf,EAAEU,MAAMM,QAAQ,QAAQC,KAAK,MACxD,IAEA,IAAIC,oBAAsBlB,EAAE,QAAS,CACjCmB,MAAS,kCAEZC,KAAKP,EAAEQ,KAAKC,WAAW,cAAe,0BAA2B,kBAE9DC,kBAAoB,WACpB,IAAIC,MAAQ,EACZxB,EAAE,6EAA6EyB,MAAK,WAChFD,OAASE,OAAO1B,EAAEU,MAAMH,MAC5B,IACAW,oBAAoBS,KAAK,QAAQP,KAAKI,QAG1CpB,oBAAoBwB,MAAMV,qBAC1BW,YAAYN,kBAAmB,KAE/BvB,EAAE,6DAA6D8B,OAAM,WACjEZ,oBAAoBa,YAAY/B,EAAEU,OAClCa,mBACJ,IACCS,MAAK,WACFd,oBAAoBa,YAAY3B,oBACnC,IACA6B,GAAG,QAASV,mBACbvB,EAAE,gEAAgEQ,OAAOe,kBAE5E,EACDW,kBAAmB,SAASC,WACxB,IAAIC,cAAgBpC,EAAE,2DACtBoC,cAAc3B,OAAM,SAAS4B,GACzBxB,EAAEQ,KAAKiB,oBAAoBD,EAAG,CAC1BE,QAAS1B,EAAEQ,KAAKC,WAAW,0BAA2B,2BACtDkB,SAAU,WACNvC,KAAKwC,KAAK,CACN,CACIC,WAAY,4CACZC,KAAM,CACFR,UAAWA,UACXS,YAAa5C,EAAE,mCAAmCO,OAEtDsC,KAAM,WAEF7C,EAAE,sCAAsC8C,SACxCV,cAAcU,SAIdC,SAASC,cAAc,2DAA2DvC,OACrF,EACDwC,KAAM/C,aAAagD,YAG/B,GAER,IACCC,MACL,EAER"}